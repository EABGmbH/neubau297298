<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KfW F√∂rderrechner 297/298 - Klimafreundlicher Neubau</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #3b5748;
            min-height: 100vh;
            padding: 40px 20px;
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            color: white;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 600;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1em;
            opacity: 0.95;
            line-height: 1.3;
        }

        .zinssaetze-info {
            margin-top: 10px;
            font-size: 0.75em;
            opacity: 0.85;
        }

        .calculator-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.12);
            padding: 30px;
            color: #333;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            padding: 15px 10px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
        }

        .progress-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1em;
            transition: all 0.3s ease;
            border: 2px solid #e0e0e0;
        }

        .progress-step.active .progress-dot {
            background: #50685b;
            color: white;
            border-color: #50685b;
            transform: scale(1.1);
        }

        .progress-step.completed .progress-dot {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .progress-step.completed .progress-dot::after {
            content: '‚úì';
            font-size: 1.5em;
        }

        .progress-label {
            margin-top: 6px;
            font-size: 0.75em;
            color: #333;
            font-weight: 500;
            white-space: nowrap;
        }

        .progress-step.active .progress-label {
            color: #50685b;
            font-weight: 700;
        }

        .progress-line {
            flex: 1;
            height: 2px;
            background: #e0e0e0;
            margin: 0 5px;
            margin-bottom: 25px;
            max-width: 60px;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .section-question {
            display: block;
            font-size: 1.3em;
            font-weight: 600;
            color: #50685b;
            margin-bottom: 25px;
            text-align: left;
            line-height: 1.3;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option-card {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .option-card:hover {
            background: #e8f0ed;
            border-color: #50685b;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(80, 104, 91, 0.2);
        }

        .option-card.selected {
            background: #50685b;
            border-color: #50685b;
            color: white;
            box-shadow: 0 5px 20px rgba(80, 104, 91, 0.4);
        }

        .option-card .card-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
        }

        .option-card .card-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            line-height: 1.3;
        }

        .option-card.selected .card-label {
            color: white;
        }

        .option-card .card-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 8px;
        }

        .option-card.selected .card-description {
            color: rgba(255, 255, 255, 0.9);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #50685b;
            box-shadow: 0 0 0 3px rgba(80, 104, 91, 0.1);
        }

        .checkbox-label {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .checkbox-label:hover {
            background: #e8f0ed;
            border-color: #50685b;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #50685b;
            flex-shrink: 0;
        }

        .step-navigation {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-navigate {
            padding: 14px 35px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-previous {
            background: #e0e0e0;
            color: #333;
        }

        .btn-previous:hover {
            background: #d0d0d0;
        }

        .btn-next {
            background: #50685b;
            color: white;
        }

        .btn-next:hover {
            background: #42574c;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(80, 104, 91, 0.4);
        }

        .btn-next:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-restart {
            background: #50685b;
            color: white;
        }

        .btn-restart:hover {
            background: #42574c;
        }

        .alert-box {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid;
        }

        .alert-error {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }

        .alert-success {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #1b5e20;
        }

        .alert-info {
            background: #e3f2fd;
            border-color: #2196F3;
            color: #1565c0;
        }

        .result-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 3px solid #f0f0f0;
        }

        .result-highlight {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            margin: 20px 0;
            padding: 30px;
            border-radius: 12px;
            border-left: 6px solid #4caf50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .result-highlight h2 {
            color: #1b5e20;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .result-highlight .big-number {
            font-size: 3em;
            font-weight: 700;
            color: #1b5e20;
            margin: 15px 0;
        }

        .result-highlight p {
            color: #2e7d32;
            font-size: 1.1em;
            font-weight: 500;
            line-height: 1.6;
        }

        .result-card {
            background: #f0f5f2;
            border-radius: 10px;
            padding: 25px;
            border-left: 4px solid #50685b;
            margin-bottom: 20px;
        }

        .result-card h3 {
            color: #50685b;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            font-size: 1em;
            color: #555;
        }

        .result-value {
            font-weight: 700;
            font-size: 1.1em;
            color: #50685b;
        }

        .comparison-bar {
            margin: 20px 0;
        }

        .comparison-item {
            margin-bottom: 20px;
        }

        .comparison-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95em;
            font-weight: 600;
            color: #333;
        }

        .bar-background {
            width: 100%;
            height: 35px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
            transition: width 0.8s ease;
        }

        .bar-fill.market {
            background: #e57373;
        }

        .bar-fill.kfw {
            background: #66bb6a;
        }

        .info-tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 5px;
        }

        .info-tooltip .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: #50685b;
            color: white;
            border-radius: 50%;
            font-size: 0.7em;
            font-weight: 700;
        }

        .info-tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #1f2937;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .info-tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid #e0e0e0;
            border-top: 4px solid #50685b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .disclaimer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .subtitle {
                font-size: 0.9em;
            }

            .calculator-card {
                padding: 20px;
            }

            .section-question {
                font-size: 1.1em;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .step-navigation {
                flex-direction: column;
            }

            .btn-navigate {
                width: 100%;
            }

            .result-highlight .big-number {
                font-size: 2.2em;
            }

            .progress-indicator {
                overflow-x: auto;
                justify-content: flex-start;
            }

            .progress-step {
                min-width: 60px;
            }

            .progress-dot {
                width: 35px;
                height: 35px;
                font-size: 0.9em;
            }

            .progress-label {
                font-size: 0.7em;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==================== KONSTANTEN ====================
        const DEFAULT_ZINSSAETZE = {
            markt: { zehn_jahre: 3.65 },
            kfw: { eh40_kfn: 2.45, eh55_befristet: 1.94 }
        };

        const DEFAULT_FOERDERGRENZEN = {
            basis: 100000,
            qng_bonus: 150000
        };

        const DEFAULT_TILGUNG = 2.00;

        // ==================== BERECHNUNGS-ENGINE ====================
        class CalculationEngine {
            static validateEligibility(formData, zinssaetze = DEFAULT_ZINSSAETZE) {
                const { constructionStarted, heating, standard, hasPermit, qngPlanned } = formData;

                if (constructionStarted) {
                    return {
                        eligible: false,
                        reason: "Baubeginn vor Antragstellung ist ein Ausschlusskriterium. Die F√∂rderung muss vor Baubeginn beantragt werden.",
                        level: "error"
                    };
                }

                if (heating === "gas" || heating === "oel" || heating === "kohle") {
                    return {
                        eligible: false,
                        reason: "Fossile Energietr√§ger (Gas, √ñl, Kohle) sind im KfW-Neubau-Programm nicht f√∂rderf√§hig. Bitte w√§hlen Sie eine erneuerbare Heizung.",
                        level: "error"
                    };
                }

                if (standard === "eh55") {
                    if (!hasPermit) {
                        return {
                            eligible: false,
                            reason: "Die befristete EH 55-F√∂rderung gilt nur f√ºr bereits genehmigte Projekte, bei denen der Bau noch nicht begonnen hat.",
                            level: "error"
                        };
                    }

                    if (heating === "biomasse") {
                        return {
                            eligible: true,
                            program: "EH 55 Befristet",
                            zinssatz: zinssaetze.kfw.eh55_befristet,
                            maxKredit: DEFAULT_FOERDERGRENZEN.basis,
                            warning: "Hinweis: Biomasse ist zugelassen, aber es muss 100% erneuerbare Energie nachgewiesen werden."
                        };
                    }

                    return {
                        eligible: true,
                        program: "EH 55 Befristet",
                        zinssatz: zinssaetze.kfw.eh55_befristet,
                        maxKredit: DEFAULT_FOERDERGRENZEN.basis
                    };
                }

                if (standard === "eh40") {
                    if (heating === "biomasse") {
                        return {
                            eligible: false,
                            reason: "Biomasseheizungen (Pellets, Hackschnitzel, Scheitholz) sind im Programm 'Klimafreundlicher Neubau' (EH 40) nicht f√∂rderf√§hig. Alternative: W√§rmepumpe oder Fernw√§rme.",
                            level: "error"
                        };
                    }

                    if (qngPlanned) {
                        return {
                            eligible: true,
                            program: "Klimafreundlicher Neubau mit QNG-Siegel",
                            zinssatz: zinssaetze.kfw.eh40_kfn,
                            maxKredit: DEFAULT_FOERDERGRENZEN.qng_bonus,
                            bonus: "Sie erhalten 50.000 ‚Ç¨ zus√§tzliches Kreditvolumen durch das QNG-Siegel!"
                        };
                    }

                    return {
                        eligible: true,
                        program: "Klimafreundlicher Neubau (KFN)",
                        zinssatz: zinssaetze.kfw.eh40_kfn,
                        maxKredit: DEFAULT_FOERDERGRENZEN.basis
                    };
                }

                return {
                    eligible: false,
                    reason: "Unbekannter Fehler in der Validierung.",
                    level: "error"
                };
            }

            static calculateFinancials(kreditbetrag, wohneinheiten, kfwZins, zinssaetze = DEFAULT_ZINSSAETZE, tilgung = DEFAULT_TILGUNG) {
                const gesamtKredit = kreditbetrag;
                const marktZins = zinssaetze.markt.zehn_jahre;

                const marktGesamtrate = (marktZins + tilgung) / 100;
                const marktMonatlicheRate = (gesamtKredit * marktGesamtrate) / 12;
                const marktZinsJahr1 = gesamtKredit * (marktZins / 100);

                const kfwGesamtrate = (kfwZins + tilgung) / 100;
                const kfwMonatlicheRate = (gesamtKredit * kfwGesamtrate) / 12;
                const kfwZinsJahr1 = gesamtKredit * (kfwZins / 100);

                const zinsdifferenz = marktZins - kfwZins;
                const zinsersparnisGesamt = gesamtKredit * (zinsdifferenz / 100) * 10;
                const monatlicheErsparnis = marktMonatlicheRate - kfwMonatlicheRate;

                return {
                    gesamtKredit,
                    markt: {
                        zinssatz: marktZins,
                        monatlicheRate: marktMonatlicheRate,
                        zinsJahr1: marktZinsJahr1
                    },
                    kfw: {
                        zinssatz: kfwZins,
                        monatlicheRate: kfwMonatlicheRate,
                        zinsJahr1: kfwZinsJahr1
                    },
                    ersparnis: {
                        monatlich: monatlicheErsparnis,
                        ueber10Jahre: zinsersparnisGesamt
                    }
                };
            }
        }

        // ==================== HAUPTKOMPONENTE ====================
        function KfWRechner() {
            const [currentStep, setCurrentStep] = useState(1);
            const [zinssaetze, setZinssaetze] = useState(null);
            const [zinssaetzeLoading, setZinssaetzeLoading] = useState(true);
            const [zinssaetzeError, setZinssaetzeError] = useState(null);
            const [formData, setFormData] = useState({
                usage: 'selbstgenutzt',
                wohneinheiten: 1,
                projectType: 'neubau',
                hasPermit: false,
                constructionStarted: false,
                standard: '',
                heating: '',
                pvPlanned: null,
                batterySpeicher: null,
                ventilation: '',
                qngPlanned: false,
                kreditwunsch: 100000
            });

            const [validationResult, setValidationResult] = useState(null);
            const [financialResult, setFinancialResult] = useState(null);

            // Zinss√§tze laden
            useEffect(() => {
                const githubUrl = 'https://raw.githubusercontent.com/EABGmbH/neubau297298/main/zinssaetze.json';
                const localUrl = './zinssaetze.json';
                
                fetch(githubUrl)
                    .then(response => {
                        if (!response.ok) throw new Error('GitHub nicht erreichbar');
                        return response.json();
                    })
                    .then(data => {
                        setZinssaetze({
                            markt: { zehn_jahre: data.markt.zehn_jahre_unter_90 },
                            kfw: { 
                                eh40_kfn: data.kfw.eh40_kfn,
                                eh55_befristet: data.kfw.eh55_befristet
                            }
                        });
                        setZinssaetzeLoading(false);
                        console.log('‚úÖ Zinss√§tze von GitHub geladen (Stand: ' + data.stand + ')');
                    })
                    .catch(error => {
                        console.warn('GitHub nicht erreichbar, versuche lokale Datei...', error);
                        fetch(localUrl)
                            .then(response => {
                                if (!response.ok) throw new Error('Auch lokale Datei nicht gefunden');
                                return response.json();
                            })
                            .then(data => {
                                setZinssaetze({
                                    markt: { zehn_jahre: data.markt.zehn_jahre_unter_90 },
                                    kfw: { 
                                        eh40_kfn: data.kfw.eh40_kfn,
                                        eh55_befristet: data.kfw.eh55_befristet
                                    }
                                });
                                setZinssaetzeLoading(false);
                                setZinssaetzeError('Lokale Zinss√§tze (GitHub offline)');
                                console.log('‚ö†Ô∏è Zinss√§tze von lokaler Datei geladen');
                            })
                            .catch(localError => {
                                console.error('Beide Quellen fehlgeschlagen, nutze Fallback-Werte');
                                setZinssaetze(DEFAULT_ZINSSAETZE);
                                setZinssaetzeError('Zinss√§tze verwenden Fallback-Werte');
                                setZinssaetzeLoading(false);
                            });
                    });
            }, []);

            useEffect(() => {
                if (currentStep === 5 && formData.heating && zinssaetze && formData.standard) {
                    const validation = CalculationEngine.validateEligibility(formData, zinssaetze);
                    setValidationResult(validation);
                    
                    if (validation.eligible) {
                        const maxKredit = validation.maxKredit * formData.wohneinheiten;
                        const actualKredit = Math.min(formData.kreditwunsch, maxKredit);
                        const finances = CalculationEngine.calculateFinancials(
                            actualKredit,
                            formData.wohneinheiten,
                            validation.zinssatz,
                            zinssaetze
                        );
                        setFinancialResult(finances);
                    }
                }
            }, [currentStep, formData, zinssaetze]);

            const updateFormData = (key, value) => {
                setFormData(prev => ({ ...prev, [key]: value }));
            };

            const nextStep = () => {
                if (currentStep < 5) {
                    setCurrentStep(prev => prev + 1);
                }
            };

            const prevStep = () => {
                if (currentStep > 1) {
                    setCurrentStep(prev => prev - 1);
                }
            };

            const resetCalculator = () => {
                setCurrentStep(1);
                setFormData({
                    usage: 'selbstgenutzt',
                    wohneinheiten: 1,
                    projectType: 'neubau',
                    hasPermit: false,
                    constructionStarted: false,
                    standard: '',
                    heating: '',
                    pvPlanned: null,
                    batterySpeicher: null,
                    ventilation: '',
                    qngPlanned: false,
                    kreditwunsch: 100000
                });
                setValidationResult(null);
                setFinancialResult(null);
            };

            if (zinssaetzeLoading) {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>KfW F√∂rderrechner 297/298</h1>
                            <p className="subtitle">Klimafreundlicher Neubau</p>
                        </div>
                        <div className="calculator-card">
                            <div className="loading-spinner">
                                <div className="spinner"></div>
                                <p style={{marginTop: '20px', color: '#666'}}>Aktuelle Zinss√§tze werden geladen...</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <>
                    <div className="container">
                        <div className="header">
                            <h1>KfW F√∂rderrechner 297/298</h1>
                            <p className="subtitle">Klimafreundlicher Neubau - Berechnen Sie Ihre Zinsvorteile</p>
                            {zinssaetzeError && (
                                <div style={{marginTop: '10px', fontSize: '0.85em', color: '#ffc107'}}>
                                    ‚ö†Ô∏è {zinssaetzeError}
                                </div>
                            )}
                            {zinssaetze && (
                                <div className="zinssaetze-info">
                                    Aktuelle Zinss√§tze: KfW EH40 {zinssaetze.kfw.eh40_kfn}% | EH55 {zinssaetze.kfw.eh55_befristet}% | Markt {zinssaetze.markt.zehn_jahre}%
                                </div>
                            )}
                        </div>

                        <div className="calculator-card">
                            <div className="progress-indicator">
                                {[1, 2, 3, 4, 5].map(step => (
                                    <React.Fragment key={step}>
                                        <div className={`progress-step ${currentStep >= step ? 'active' : ''} ${currentStep > step ? 'completed' : ''}`}>
                                            <div className="progress-dot">
                                                {currentStep > step ? '' : step}
                                            </div>
                                            <div className="progress-label">
                                                Schritt {step}
                                            </div>
                                        </div>
                                        {step < 5 && <div className="progress-line"></div>}
                                    </React.Fragment>
                                ))}
                            </div>

                            <div className={`form-step ${currentStep === 1 ? 'active' : ''}`}>
                                <Step1Projekt 
                                    formData={formData} 
                                    updateFormData={updateFormData}
                                    nextStep={nextStep}
                                />
                            </div>
                            
                            <div className={`form-step ${currentStep === 2 ? 'active' : ''}`}>
                                <Step2Status 
                                    formData={formData} 
                                    updateFormData={updateFormData}
                                    nextStep={nextStep}
                                    prevStep={prevStep}
                                />
                            </div>
                            
                            <div className={`form-step ${currentStep === 3 ? 'active' : ''}`}>
                                <Step3Technik 
                                    formData={formData} 
                                    updateFormData={updateFormData}
                                    nextStep={nextStep}
                                    prevStep={prevStep}
                                />
                            </div>
                            
                            <div className={`form-step ${currentStep === 4 ? 'active' : ''}`}>
                                <Step4PV 
                                    formData={formData} 
                                    updateFormData={updateFormData}
                                    nextStep={nextStep}
                                    prevStep={prevStep}
                                />
                            </div>
                            
                            <div className={`form-step ${currentStep === 5 ? 'active' : ''}`}>
                                <Step5Ergebnis 
                                    formData={formData}
                                    validationResult={validationResult}
                                    financialResult={financialResult}
                                    updateFormData={updateFormData}
                                    prevStep={prevStep}
                                    resetCalculator={resetCalculator}
                                    zinssaetze={zinssaetze}
                                />
                            </div>
                        </div>

                        <div className="disclaimer">
                            <p><strong>Wichtiger Hinweis:</strong> Alle Angaben ohne Gew√§hr. Die hier berechneten Werte sind Modellrechnungen und ersetzen keine verbindliche Bankauskunft.</p>
                            <p>Stand der Zinsdaten: Februar 2026. Die finale F√∂rderf√§higkeit muss durch einen Energie-Effizienz-Experten best√§tigt werden.</p>
                        </div>
                    </div>
                </>
            );
        }

        // ==================== STEP 1: PROJEKT ====================
        function Step1Projekt({ formData, updateFormData, nextStep }) {
            const canProceed = formData.usage && formData.wohneinheiten > 0;

            return (
                <div>
                    <h2 className="section-question">Wie wird die Immobilie genutzt?</h2>

                    <div className="card-grid">
                        <div
                            onClick={() => updateFormData('usage', 'selbstgenutzt')}
                            className={`option-card ${formData.usage === 'selbstgenutzt' ? 'selected' : ''}`}
                        >
                            <div className="card-icon">üè†</div>
                            <div className="card-label">Ich ziehe selbst ein</div>
                            <div className="card-description">F√ºr Eigennutzer (KfW Programm 297)</div>
                        </div>

                        <div
                            onClick={() => updateFormData('usage', 'vermietet')}
                            className={`option-card ${formData.usage === 'vermietet' ? 'selected' : ''}`}
                        >
                            <div className="card-icon">üè¢</div>
                            <div className="card-label">Ich vermiete</div>
                            <div className="card-description">F√ºr Investoren und Vermieter (KfW Programm 298)</div>
                        </div>
                    </div>

                    <div className="form-group">
                        <label>Anzahl der Wohneinheiten</label>
                        <input
                            type="number"
                            min="1"
                            max="20"
                            value={formData.wohneinheiten}
                            onChange={(e) => updateFormData('wohneinheiten', parseInt(e.target.value) || 1)}
                        />
                        <p style={{marginTop: '8px', fontSize: '0.9em', color: '#666'}}>
                            Die F√∂rdergrenze gilt pro Wohneinheit (max. 100.000 ‚Ç¨ bzw. 150.000 ‚Ç¨ mit QNG)
                        </p>
                    </div>

                    <div className="step-navigation">
                        <div></div>
                        <button
                            onClick={nextStep}
                            disabled={!canProceed}
                            className="btn-navigate btn-next"
                        >
                            Weiter ‚Üí
                        </button>
                    </div>
                </div>
            );
        }

        // ==================== STEP 2: STATUS ====================
        function Step2Status({ formData, updateFormData, nextStep, prevStep }) {
            return (
                <div>
                    <h2 className="section-question">Projektstatus</h2>

                    <div className="checkbox-label" style={{background: formData.hasPermit ? '#e8f0ed' : 'white'}}>
                        <input
                            type="checkbox"
                            checked={formData.hasPermit}
                            onChange={(e) => updateFormData('hasPermit', e.target.checked)}
                        />
                        <div>
                            <strong>Liegt bereits eine Baugenehmigung vor?</strong>
                            <p style={{marginTop: '5px', fontSize: '0.9em', color: '#666'}}>
                                Falls ja, stehen Ihnen m√∂glicherweise zus√§tzliche F√∂rderoptionen zur Verf√ºgung.
                            </p>
                        </div>
                    </div>

                    <div className="checkbox-label" style={{background: formData.constructionStarted ? '#fff3e0' : 'white', borderColor: formData.constructionStarted ? '#ff9800' : '#e0e0e0'}}>
                        <input
                            type="checkbox"
                            checked={formData.constructionStarted}
                            onChange={(e) => updateFormData('constructionStarted', e.target.checked)}
                        />
                        <div>
                            <strong>Wurde mit dem Bau bereits begonnen?</strong>
                            <p style={{marginTop: '5px', fontSize: '0.9em', color: '#e65100'}}>
                                ‚ö†Ô∏è ACHTUNG: Ein Baubeginn vor Antragstellung f√ºhrt zum Ausschluss der F√∂rderung!
                            </p>
                        </div>
                    </div>

                    {formData.constructionStarted && (
                        <div className="alert-box alert-error">
                            <strong>‚ùå Nicht f√∂rderf√§hig</strong>
                            <p style={{marginTop: '8px'}}>
                                Wenn der Bau bereits begonnen hat, kann keine KfW-F√∂rderung mehr beantragt werden. 
                                Die Antragstellung muss VOR Baubeginn erfolgen.
                            </p>
                        </div>
                    )}

                    {!formData.constructionStarted && (
                        <div className="alert-box alert-info" style={{marginTop: '20px'}}>
                            <strong>‚ÑπÔ∏è Beide Angaben sind optional</strong>
                            <p style={{marginTop: '8px'}}>
                                Sie k√∂nnen auch ohne Angaben fortfahren - wir ermitteln dann im n√§chsten Schritt, 
                                welche F√∂rderoptionen f√ºr Sie infrage kommen.
                            </p>
                        </div>
                    )}

                    <div className="step-navigation">
                        <button onClick={prevStep} className="btn-navigate btn-previous">
                            ‚Üê Zur√ºck
                        </button>
                        <button onClick={nextStep} className="btn-navigate btn-next">
                            Weiter ‚Üí
                        </button>
                    </div>
                </div>
            );
        }

        // ==================== STEP 3: TECHNIK ====================
        function Step3Technik({ formData, updateFormData, nextStep, prevStep }) {
            const heatingOptions = [
                { value: 'wp', label: 'W√§rmepumpe', icon: '‚ô®Ô∏è', desc: 'Luft-, Erd- oder Wasser-WP', compatible: ['eh40', 'eh55'] },
                { value: 'fernwaerme', label: 'Fernw√§rme', icon: 'üè≠', desc: '‚â•75% erneuerbar', compatible: ['eh40', 'eh55'] },
                { value: 'biomasse', label: 'Biomasse', icon: 'üå≥', desc: 'Pellets, Hackschnitzel', compatible: ['eh55'] },
                { value: 'gas', label: 'Gasheizung', icon: 'üî•', desc: 'Nicht f√∂rderf√§hig', compatible: [], blocked: true },
                { value: 'oel', label: '√ñlheizung', icon: 'üõ¢Ô∏è', desc: 'Nicht f√∂rderf√§hig', compatible: [], blocked: true }
            ];

            const canProceed = formData.heating;

            return (
                <div>
                    <h2 className="section-question">Welches Heizungssystem ist geplant?</h2>

                    <div className="card-grid">
                        {heatingOptions.map(option => {
                            const isBlocked = option.blocked;
                            const isSelected = formData.heating === option.value;

                            return (
                                <div
                                    key={option.value}
                                    onClick={() => {
                                        if (!isBlocked) {
                                            updateFormData('heating', option.value);
                                        }
                                    }}
                                    className={`option-card ${isSelected ? 'selected' : ''}`}
                                    style={{
                                        opacity: isBlocked ? 0.5 : 1,
                                        cursor: isBlocked ? 'not-allowed' : 'pointer',
                                        borderColor: isBlocked ? '#e57373' : (isSelected ? '#50685b' : '#e0e0e0'),
                                        background: isBlocked ? '#ffebee' : (isSelected ? '#50685b' : '#f5f5f5')
                                    }}
                                >
                                    <div className="card-icon">{option.icon}</div>
                                    <div className="card-label">{option.label}</div>
                                    <div className="card-description">{option.desc}</div>
                                    {isBlocked && <div style={{marginTop: '5px', color: '#c62828', fontSize: '0.85em', fontWeight: 600}}>‚ùå Ausgeschlossen</div>}
                                </div>
                            );
                        })}
                    </div>

                    {formData.heating && formData.heating === 'biomasse' && (
                        <div className="alert-box alert-warning" style={{marginTop: '20px'}}>
                            <strong>‚ö†Ô∏è Hinweis zu Biomasse</strong>
                            <p style={{marginTop: '8px'}}>
                                Biomasseheizungen sind nur im Effizienzhaus 55 Standard f√∂rderf√§hig. 
                                Es muss ein 100% erneuerbarer Energienachweis erbracht werden. 
                                F√ºr den h√∂heren EH40-Standard w√§re eine W√§rmepumpe erforderlich.
                            </p>
                        </div>
                    )}

                    {formData.heating && (formData.heating === 'wp' || formData.heating === 'fernwaerme') && (
                        <div className="alert-box alert-success" style={{marginTop: '20px'}}>
                            <strong>‚úÖ Sehr gut!</strong>
                            <p style={{marginTop: '8px'}}>
                                Mit {formData.heating === 'wp' ? 'einer W√§rmepumpe' : 'Fernw√§rme'} sind sowohl 
                                Effizienzhaus 40 als auch Effizienzhaus 55 erreichbar. Im n√§chsten Schritt 
                                ermitteln wir gemeinsam, welcher Standard f√ºr Sie optimal ist.
                            </p>
                        </div>
                    )}

                    <div className="step-navigation">
                        <button onClick={prevStep} className="btn-navigate btn-previous">
                            ‚Üê Zur√ºck
                        </button>
                        <button
                            onClick={nextStep}
                            disabled={!canProceed}
                            className="btn-navigate btn-next"
                        >
                            Weiter ‚Üí
                        </button>
                    </div>
                </div>
            );
        }

        // ==================== STEP 4: PV UND SPEICHER ====================
        function Step4PV({ formData, updateFormData, nextStep, prevStep }) {
            const canProceed = formData.pvPlanned !== null;

            return (
                <div>
                    <h2 className="section-question">Photovoltaik und Stromspeicher</h2>

                    <div className="alert-box alert-info">
                        <strong>‚ÑπÔ∏è Warum ist das wichtig?</strong>
                        <p style={{marginTop: '8px', lineHeight: 1.6}}>
                            Eine PV-Anlage verbessert die Energiebilanz Ihres Geb√§udes erheblich und erleichtert 
                            die Erf√ºllung h√∂herer Effizienzhaus-Standards. Ein Stromspeicher erh√∂ht zus√§tzlich 
                            den Eigenverbrauch und die Unabh√§ngigkeit.
                        </p>
                    </div>

                    <h2 className="section-question" style={{marginTop: '25px'}}>Photovoltaik-Anlage</h2>

                    <div className="card-grid">
                        <div
                            onClick={() => updateFormData('pvPlanned', true)}
                            className={`option-card ${formData.pvPlanned === true ? 'selected' : ''}`}
                        >
                            <div className="card-icon">‚òÄÔ∏è</div>
                            <div className="card-label">Ja, PV-Anlage geplant</div>
                            <div className="card-description">Stromerzeugung auf dem Dach</div>
                        </div>

                        <div
                            onClick={() => {
                                updateFormData('pvPlanned', false);
                                updateFormData('batterySpeicher', false);
                            }}
                            className={`option-card ${formData.pvPlanned === false ? 'selected' : ''}`}
                        >
                            <div className="card-icon">‚ö™</div>
                            <div className="card-label">Nein, keine PV-Anlage</div>
                            <div className="card-description">Strombezug aus dem Netz</div>
                        </div>
                    </div>

                    {formData.pvPlanned === true && (
                        <>
                            <h2 className="section-question" style={{marginTop: '30px'}}>Stromspeicher / Batterie</h2>

                            <div className="card-grid">
                                <div
                                    onClick={() => updateFormData('batterySpeicher', true)}
                                    className={`option-card ${formData.batterySpeicher === true ? 'selected' : ''}`}
                                >
                                    <div className="card-icon">üîã</div>
                                    <div className="card-label">Ja, mit Batteriespeicher</div>
                                    <div className="card-description">Erh√∂ht Eigenverbrauch auf 60-80%</div>
                                </div>

                                <div
                                    onClick={() => updateFormData('batterySpeicher', false)}
                                    className={`option-card ${formData.batterySpeicher === false ? 'selected' : ''}`}
                                >
                                    <div className="card-icon">‚ö°</div>
                                    <div className="card-label">Nein, ohne Speicher</div>
                                    <div className="card-description">Direkter Verbrauch / Netzeinspeisung</div>
                                </div>
                            </div>

                            <div className="alert-box alert-success" style={{marginTop: '15px'}}>
                                <strong>üí° Tipp:</strong> Ein Batteriespeicher erm√∂glicht die Nutzung von Solarstrom auch abends 
                                und nachts. F√∂rderprogramme f√ºr Speicher gibt es zus√§tzlich bei einigen Bundesl√§ndern.
                            </div>
                        </>
                    )}

                    <div className="step-navigation">
                        <button onClick={prevStep} className="btn-navigate btn-previous">
                            ‚Üê Zur√ºck
                        </button>
                        <button
                            onClick={nextStep}
                            disabled={!canProceed}
                            className="btn-navigate btn-next"
                        >
                            Weiter ‚Üí
                        </button>
                    </div>
                </div>
            );
        }

        // ==================== STEP 5: ERGEBNIS ====================
        function Step5Ergebnis({ formData, validationResult, financialResult, updateFormData, prevStep, resetCalculator, zinssaetze }) {
            const [eh40Result, setEh40Result] = useState(null);
            const [eh55Result, setEh55Result] = useState(null);
            
            const heatingOptions = [
                { value: 'wp', label: 'W√§rmepumpe', compatible: ['eh40', 'eh55'] },
                { value: 'fernwaerme', label: 'Fernw√§rme', compatible: ['eh40', 'eh55'] },
                { value: 'biomasse', label: 'Biomasse', compatible: ['eh55'] }
            ];
            
            const selectedHeating = heatingOptions.find(h => h.value === formData.heating);
            const compatibleStandards = selectedHeating ? selectedHeating.compatible : ['eh40', 'eh55'];
            const hasBothOptions = compatibleStandards.length > 1;
            
            // Berechne beide Varianten f√ºr Vergleich
            useEffect(() => {
                if (!hasBothOptions) {
                    // Nur eine Option - auto-select
                    if (formData.heating === 'biomasse' && formData.standard !== 'eh55') {
                        updateFormData('standard', 'eh55');
                    }
                } else if (!formData.standard && zinssaetze) {
                    // Beide Standards berechnen f√ºr Vergleich
                    const testData40 = {...formData, standard: 'eh40', qngPlanned: false};
                    const testData55 = {...formData, standard: 'eh55', qngPlanned: false};
                    
                    const validation40 = CalculationEngine.validateEligibility(testData40, zinssaetze);
                    const validation55 = CalculationEngine.validateEligibility(testData55, zinssaetze);
                    
                    if (validation40.eligible) {
                        const maxKredit40 = validation40.maxKredit * formData.wohneinheiten;
                        const actualKredit40 = Math.min(formData.kreditwunsch, maxKredit40);
                        const finances40 = CalculationEngine.calculateFinancials(
                            actualKredit40,
                            formData.wohneinheiten,
                            validation40.zinssatz,
                            zinssaetze
                        );
                        setEh40Result({validation: validation40, finances: finances40, maxKredit: maxKredit40});
                    }
                    
                    if (validation55.eligible) {
                        const maxKredit55 = validation55.maxKredit * formData.wohneinheiten;
                        const actualKredit55 = Math.min(formData.kreditwunsch, maxKredit55);
                        const finances55 = CalculationEngine.calculateFinancials(
                            actualKredit55,
                            formData.wohneinheiten,
                            validation55.zinssatz,
                            zinssaetze
                        );
                        setEh55Result({validation: validation55, finances: finances55, maxKredit: maxKredit55});
                    }
                }
            }, [formData.heating, hasBothOptions, formData.standard, zinssaetze]);

            const maxKreditGesamt = validationResult ? validationResult.maxKredit * formData.wohneinheiten : 0;

            return (
                <div>
                    {!formData.standard ? (
                        <>
                            <h2 className="section-question">W√§hlen Sie Ihren Effizienzhaus-Standard</h2>

                            {!hasBothOptions ? (
                                <div className="alert-box alert-info" style={{marginBottom: '20px'}}>
                                    <strong>‚ÑπÔ∏è Hinweis:</strong> Mit Biomasse-Heizung ist nur der <strong>Effizienzhaus 55 Standard</strong> f√∂rderf√§hig.
                                </div>
                            ) : (
                                <>
                                    {formData.pvPlanned === true ? (
                                        <div className="alert-box alert-success" style={{marginBottom: '20px'}}>
                                            <strong>‚úÖ Mit PV-Anlage:</strong> Vergleichen Sie die konkreten Ersparnisse - 
                                            EH 40 bietet in der Regel deutlich bessere Konditionen!
                                        </div>
                                    ) : (
                                        <div className="alert-box alert-warning" style={{marginBottom: '20px'}}>
                                            <strong>‚ö†Ô∏è Ohne PV-Anlage:</strong> EH 40 erfordert sehr gute D√§mmwerte. 
                                            Schauen Sie sich die konkreten Zahlen an, um die beste Entscheidung zu treffen.
                                        </div>
                                    )}
                                </>
                            )}

                            {!hasBothOptions || (!eh40Result && !eh55Result) ? (
                                <div className="loading-spinner">
                                    <div className="spinner"></div>
                                    <p style={{marginTop: '20px', color: '#666'}}>Berechne Ihre F√∂rderoptionen...</p>
                                </div>
                            ) : (
                                <div className="card-grid" style={{gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px'}}>
                                    {eh40Result && (
                                        <div
                                            onClick={() => updateFormData('standard', 'eh40')}
                                            className="option-card"
                                            style={{
                                                padding: '25px 20px',
                                                border: '3px solid #4caf50',
                                                background: 'linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%)',
                                                cursor: 'pointer',
                                                position: 'relative'
                                            }}
                                        >
                                            <div style={{position: 'absolute', top: '12px', right: '12px', background: '#4caf50', color: 'white', padding: '4px 10px', borderRadius: '15px', fontSize: '0.75em', fontWeight: 700}}>
                                                EMPFOHLEN
                                            </div>
                                            <div className="card-icon" style={{fontSize: '2.5em', marginBottom: '10px'}}>‚≠ê</div>
                                            <div style={{fontSize: '1.3em', fontWeight: 700, color: '#1b5e20', marginBottom: '8px'}}>Effizienzhaus 40</div>
                                            <div style={{fontSize: '0.85em', color: '#2e7d32', marginBottom: '15px'}}>
                                                Klimafreundlicher Neubau
                                            </div>
                                            
                                            <div style={{background: 'white', padding: '15px', borderRadius: '8px', marginBottom: '12px'}}>
                                                <div style={{fontSize: '0.8em', color: '#666', marginBottom: '8px'}}>üí∞ Ihre Ersparnis:</div>
                                                <div style={{fontSize: '2em', fontWeight: 700, color: '#1b5e20', lineHeight: 1}}>
                                                    {Math.round(eh40Result.finances.ersparnis.ueber10Jahre).toLocaleString('de-DE')} ‚Ç¨
                                                </div>
                                                <div style={{fontSize: '0.85em', color: '#666', marginTop: '5px'}}>√ºber 10 Jahre</div>
                                                <div style={{fontSize: '0.95em', color: '#2e7d32', marginTop: '8px', fontWeight: 600}}>
                                                    {eh40Result.finances.ersparnis.monatlich.toFixed(2)} ‚Ç¨ / Monat
                                                </div>
                                            </div>
                                            
                                            <div style={{fontSize: '0.85em', color: '#2e7d32', lineHeight: 1.4}}>
                                                <strong>‚úì</strong> KfW-Zins: {eh40Result.validation.zinssatz}%<br/>
                                                <strong>‚úì</strong> Bis zu 150.000 ‚Ç¨ mit QNG<br/>
                                                <strong>‚úì</strong> Dauerhaft verf√ºgbar
                                            </div>
                                            
                                            <button 
                                                style={{
                                                    marginTop: '15px',
                                                    width: '100%',
                                                    padding: '12px',
                                                    background: '#4caf50',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    fontSize: '1em',
                                                    fontWeight: 700,
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                EH 40 w√§hlen ‚Üí
                                            </button>
                                        </div>
                                    )}

                                    {eh55Result && (
                                        <div
                                            onClick={() => {
                                                updateFormData('standard', 'eh55');
                                                updateFormData('qngPlanned', false);
                                            }}
                                            className="option-card"
                                            style={{
                                                padding: '25px 20px',
                                                border: '3px solid #ff9800',
                                                background: 'linear-gradient(135deg, #fff3e0 0%, #fef5ea 100%)',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            <div className="card-icon" style={{fontSize: '2.5em', marginBottom: '10px'}}>‚è∞</div>
                                            <div style={{fontSize: '1.3em', fontWeight: 700, color: '#e65100', marginBottom: '8px'}}>Effizienzhaus 55</div>
                                            <div style={{fontSize: '0.85em', color: '#f57c00', marginBottom: '15px'}}>
                                                Befristetes Programm
                                            </div>
                                            
                                            <div style={{background: 'white', padding: '15px', borderRadius: '8px', marginBottom: '12px'}}>
                                                <div style={{fontSize: '0.8em', color: '#666', marginBottom: '8px'}}>üí∞ Ihre Ersparnis:</div>
                                                <div style={{fontSize: '2em', fontWeight: 700, color: '#e65100', lineHeight: 1}}>
                                                    {Math.round(eh55Result.finances.ersparnis.ueber10Jahre).toLocaleString('de-DE')} ‚Ç¨
                                                </div>
                                                <div style={{fontSize: '0.85em', color: '#666', marginTop: '5px'}}>√ºber 10 Jahre</div>
                                                <div style={{fontSize: '0.95em', color: '#f57c00', marginTop: '8px', fontWeight: 600}}>
                                                    {eh55Result.finances.ersparnis.monatlich.toFixed(2)} ‚Ç¨ / Monat
                                                </div>
                                            </div>
                                            
                                            <div style={{fontSize: '0.85em', color: '#f57c00', lineHeight: 1.4}}>
                                                <strong>‚úì</strong> KfW-Zins: {eh55Result.validation.zinssatz}%<br/>
                                                <strong>‚úì</strong> Bis zu 100.000 ‚Ç¨ pro WE<br/>
                                                <strong>‚ö†</strong> Nur mit Genehmigung
                                            </div>
                                            
                                            <button 
                                                style={{
                                                    marginTop: '15px',
                                                    width: '100%',
                                                    padding: '12px',
                                                    background: '#ff9800',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    fontSize: '1em',
                                                    fontWeight: 700,
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                EH 55 w√§hlen ‚Üí
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="step-navigation" style={{marginTop: '30px'}}>
                                <button onClick={prevStep} className="btn-navigate btn-previous">
                                    ‚Üê Zur√ºck
                                </button>
                                <div></div>
                            </div>
                        </>
                    ) : (
                        <>
                            {!validationResult ? (
                                <div className="loading-spinner">
                                    <div className="spinner"></div>
                                    <p style={{marginTop: '20px', color: '#666'}}>Berechnung l√§uft...</p>
                                </div>
                            ) : (
                                <>
                            <h2 className="section-question">Ihr F√∂rder-Ergebnis</h2>

                            {!validationResult.eligible ? (
                                <>
                            <div className="alert-box alert-error">
                                <strong style={{fontSize: '1.2em'}}>‚ùå Leider nicht f√∂rderf√§hig</strong>
                                <p style={{marginTop: '10px', lineHeight: 1.6}}>
                                    {validationResult.reason}
                                </p>
                            </div>

                            <div className="step-navigation">
                                <button onClick={prevStep} className="btn-navigate btn-previous">
                                    ‚Üê Zur√ºck
                                </button>
                                <button onClick={resetCalculator} className="btn-navigate btn-restart">
                                    Neu berechnen
                                </button>
                            </div>
                        </>
                    ) : (
                        <>
                            <div className="alert-box alert-success">
                                <strong style={{fontSize: '1.2em'}}>‚úÖ Herzlichen Gl√ºckwunsch! Ihr Projekt ist f√∂rderf√§hig</strong>
                                <p style={{marginTop: '10px', lineHeight: 1.6}}>
                                    <strong>Programm:</strong> {validationResult.program}<br/>
                                    <strong>KfW {formData.usage === 'selbstgenutzt' ? '297' : '298'}</strong> - KfW-Zinssatz: <strong>{validationResult.zinssatz}%</strong>
                                </p>
                                {validationResult.bonus && (
                                    <p style={{marginTop: '8px', fontWeight: 600, color: '#1b5e20'}}>
                                        üéâ {validationResult.bonus}
                                    </p>
                                )}
                                {validationResult.warning && (
                                    <p style={{marginTop: '8px', color: '#e65100'}}>
                                        ‚ÑπÔ∏è {validationResult.warning}
                                    </p>
                                )}
                            </div>

                            <div className="form-group">
                                <label>Maximaler Kreditbetrag f√ºr Ihr Projekt: <strong>{maxKreditGesamt.toLocaleString('de-DE')} ‚Ç¨</strong> ({formData.wohneinheiten} WE √ó {validationResult.maxKredit.toLocaleString('de-DE')} ‚Ç¨)</label>
                                <input
                                    type="text"
                                    value={formData.kreditwunsch.toLocaleString('de-DE') + ' ‚Ç¨'}
                                    onChange={(e) => {
                                        const value = e.target.value.replace(/\./g, '').replace(/\s/g, '').replace(/‚Ç¨/g, '');
                                        const numValue = parseInt(value) || 0;
                                        updateFormData('kreditwunsch', numValue);
                                    }}
                                    style={{fontSize: '1.2em', fontWeight: 600}}
                                />
                                <p style={{marginTop: '8px', fontSize: '0.9em', color: '#666'}}>
                                    Geben Sie den gew√ºnschten Kreditbetrag ein (zwischen 10.000 ‚Ç¨ und {maxKreditGesamt.toLocaleString('de-DE')} ‚Ç¨)
                                </p>
                                {formData.kreditwunsch > maxKreditGesamt && (
                                    <p style={{marginTop: '5px', fontSize: '0.9em', color: '#e65100', fontWeight: 600}}>
                                        ‚ö†Ô∏è Der gew√ºnschte Betrag √ºberschreitet die F√∂rdergrenze. Es werden maximal {maxKreditGesamt.toLocaleString('de-DE')} ‚Ç¨ berechnet.
                                    </p>
                                )}
                            </div>

                            {financialResult && (
                                <div className="result-section">
                                    <div className="result-highlight">
                                        <h2>üí∞ Ihr KfW-Vorteil</h2>
                                        <div className="big-number">
                                            {Math.round(financialResult.ersparnis.ueber10Jahre).toLocaleString('de-DE')} ‚Ç¨
                                        </div>
                                        <p>
                                            Gesamtersparnis √ºber 10 Jahre Zinsbindung<br/>
                                            Das entspricht <strong>{financialResult.ersparnis.monatlich.toFixed(2)} ‚Ç¨ mehr Liquidit√§t pro Monat</strong>
                                        </p>
                                    </div>

                                    <div className="result-card">
                                        <h3>Detaillierter Finanzvergleich</h3>
                                        
                                        <div className="result-item">
                                            <span className="result-label">Kreditbetrag</span>
                                            <span className="result-value">{financialResult.gesamtKredit.toLocaleString('de-DE')} ‚Ç¨</span>
                                        </div>

                                        <div className="comparison-bar">
                                            <div className="comparison-item">
                                                <div className="comparison-label">
                                                    <span>Hausbank (Interhyp) - {financialResult.markt.zinssatz.toFixed(2)}%</span>
                                                    <span>{financialResult.markt.monatlicheRate.toFixed(2)} ‚Ç¨/Monat</span>
                                                </div>
                                                <div className="bar-background">
                                                    <div 
                                                        className="bar-fill market"
                                                        style={{width: '100%'}}
                                                    >
                                                        {financialResult.markt.zinssatz.toFixed(2)}%
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="comparison-item">
                                                <div className="comparison-label">
                                                    <span>KfW {formData.usage === 'selbstgenutzt' ? '297' : '298'} - {financialResult.kfw.zinssatz.toFixed(2)}%</span>
                                                    <span>{financialResult.kfw.monatlicheRate.toFixed(2)} ‚Ç¨/Monat</span>
                                                </div>
                                                <div className="bar-background">
                                                    <div 
                                                        className="bar-fill kfw"
                                                        style={{
                                                            width: `${(financialResult.kfw.zinssatz / financialResult.markt.zinssatz) * 100}%`
                                                        }}
                                                    >
                                                        {financialResult.kfw.zinssatz.toFixed(2)}%
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="result-item" style={{borderTop: '2px solid #e0e0e0', paddingTop: '15px', marginTop: '10px'}}>
                                            <span className="result-label">Monatliche Ersparnis</span>
                                            <span className="result-value" style={{color: '#4caf50'}}>-{financialResult.ersparnis.monatlich.toFixed(2)} ‚Ç¨</span>
                                        </div>
                                    </div>

                                    <div className="alert-box alert-info">
                                        <strong>üìã N√§chste Schritte</strong>
                                        <ol style={{marginTop: '10px', marginLeft: '20px', lineHeight: 1.8}}>
                                            <li>Kontaktieren Sie einen zertifizierten Energie-Effizienz-Experten</li>
                                            <li>Lassen Sie die technische Machbarkeit best√§tigen</li>
                                            <li>Stellen Sie den KfW-Antrag VOR Baubeginn √ºber Ihre Hausbank</li>
                                            <li>Nach Zusage: Bauvorhaben starten und F√∂rderung nutzen</li>
                                        </ol>
                                        <div style={{marginTop: '15px'}}>
                                            <a 
                                                href="https://www.energie-effizienz-experten.de/" 
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                style={{
                                                    display: 'inline-block',
                                                    padding: '12px 24px',
                                                    background: '#50685b',
                                                    color: 'white',
                                                    textDecoration: 'none',
                                                    borderRadius: '8px',
                                                    fontWeight: 600,
                                                    transition: 'all 0.3s ease'
                                                }}
                                            >
                                                Experten finden ‚Üí
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="step-navigation">
                                <button onClick={prevStep} className="btn-navigate btn-previous">
                                    ‚Üê Zur√ºck
                                </button>
                                <button onClick={resetCalculator} className="btn-navigate btn-restart">
                                    Neu berechnen
                                </button>
                            </div>
                        </>
                    )}
                    </>
                    )}
                    </>
                    )}
                </div>
            );
        }

        // ==================== APP MOUNT ====================
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<KfWRechner />);
    </script>
</body>
</html>